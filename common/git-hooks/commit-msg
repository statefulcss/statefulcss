#!/bin/sh

# Conventional Commits validation for Rush.js monorepo
# Format: <type>(<scope>): <description>
#         <type>: <description>

# Valid commit types (conventional commits standard)
COMMIT_TYPES="feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert"

# Known scopes (add new scopes as packages are added)
# core     - packages/core/
# cli      - packages/cli/
# docs     - apps/docs/
# examples - examples/
# repo     - monorepo config
# ci       - CI/CD workflows
# deps     - dependency updates
KNOWN_SCOPES="core|cli|docs|examples|repo|ci|deps"
# Read the commit message (first line only for validation)
COMMIT_MSG=$(head -n1 "$1")

# Pattern: type(scope): description OR type: description
# Scope can be any lowercase alphanumeric with hyphens (loose check for future packages)
PATTERN="^(${COMMIT_TYPES})(\([a-z0-9-]+\))?!?: .{3,}"

if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
  echo ""
  echo "‚ùå Invalid commit message format"
  echo ""
  echo "Expected: <type>(<scope>): <description>"
  echo "          <type>: <description>"
  echo ""
  echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
  echo ""
  echo "Scopes:"
  echo "  core      - packages/core/"
  echo "  cli       - packages/cli/"
  echo "  docs      - apps/docs/"
  echo "  examples  - examples/"
  echo "  repo      - monorepo config"
  echo "  ci        - CI/CD workflows"
  echo "  deps      - dependency updates"
  echo ""
  echo "Examples:"
  echo "  feat(core): add state types"
  echo "  fix(cli): handle exit codes"
  echo "  chore(deps): update vitest"
  echo "  docs: update readme"
  echo ""
  exit 1
fi
